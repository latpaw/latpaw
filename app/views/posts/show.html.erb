<%- e_mail = current_user.email rescue nil %>
<% unless notice.nil? %>
<p id="notice" class="alert alert-info">
<a class="close" data-dismiss="alert">Ã—</a>
<%= notice %>
</p>
<% end %>
<p><%= link_to "Home", :root %> / <%= link_to "Posts", posts_path %> / <%= @post.name %></p>
  <h1> <%= @post.name %></h1>
  <p><%= social_share_button_tag(@post.name) %></p>
  <%=h time_tag @post.created_at ,:class=>"gray"%> 
  <%= link_to ". By "+@user.email, "/users/edit", :class=>"gray"%>
 
 <% unless @post.video2.to_s.empty? %>
   <% if MIME::Types.type_for(@post.video2.path).to_s.index("video") %>
   <p>The video type is <%= MIME::Types.type_for(@post.video2.path).to_s %>. You can try firefox or some nagvator.</p>
     <p><video src="<%= @post.video2.url %>" controls="controls" class="span12" id="video" >not support mp4</video></p>
     <p class="btn btn-info wideview">Wide View</p>
     <p class="btn btn-info normalview">Normal View</p>
   <% end %>
   <% if MIME::Types.type_for(@post.video2.path).to_s.index("image") %>
     <p><%= link_to(@post.video2.url) do %><img src="<%= @post.video2.url %>" />  
        <% end %>
     </p>
   <% end %>
 <% end %>

<p>
  <%= raw markdown.render(@post.content) %>
</p>


<p class="tags clear-fix"><i class="icon-tags pull-left"></i><span> : </span>
<% @post.tags.each do |tag| %>
  <%= link_to(:action=>:tag,:tag_id=>tag.name) do %>
    <span class="label label-success"><%= tag.name%></span>
  <% end %>
  <%= link_to 'x', {
                    :action =>"remove_tag",
                    :id=> @post.id,
                    :tag_id => tag.name,
                    :confirm => 'Are you sure to delete the tag?',
                    :controller=>'posts',
                   }, :class=>'remove_tag'%>

<% end %>

  
<i class="icon-plus add_tag" onclick="if(document.getElementById('add_tag').style.display=='none'){document.getElementById('add_tag').style.display='block';}else{document.getElementById('add_tag').style.display='none';}" ></i>

</p>

<section id="add_tag"> 
<%= form_tag({:action=>"add_tag",:remote=>true,:id=>@post.id,:controller=>"posts"},:method=>:put) do %>
  <%= text_field_tag :tag_id,nil,:class=>"tag_field",:placeholder=>"Tag Name" %>
  <%= submit_tag 'Add A Tag',:class=>'btn btn-info',:disable_with=>"Adding" %>
<% end %>
</section>

<% if can? :destroy, @post %>
<%= link_to 'Destroy', @post , :method=> :delete , :confirm=>"Are you sure to delete ?" %> | 
<% end %>
<% if can? :update, @post %>
<%= link_to 'Edit', edit_post_path(@post) %> |
<% end %>
<%= link_to 'Back', posts_path %>
<br /><br />

<section class="comment-wrap">
<p class="label label-info commcount"><%= @post.comments.count.to_s %> comments has been submitted.</p>
<% @post.comments.each do |comment| %>
<div class="comment">
  <%= link_to 'X', [comment.post, comment],
               :confirm => 'Are you sure?',
               :method => :delete ,
               :class=>'fr'%>
<span><a href="#"><%= comment.commenter%></a> &bull; <%= time_ago_in_words(comment.created_at) %> ago</span><br />
<p class="comment-c"><%= comment.body %></p> <br />

<% if comment.fromid %>
<p class="replyshow"><span>Reply To : @</span><%= reply(comment,@post) %></p> 
<% end -%>

<p class="reply"><i class="icon-share-alt pull-right" onclick="if(document.getElementById('add_reply-<%= comment.id%>').style.display=='none'){document.getElementById('add_reply-<%= comment.id%>').style.display='block';}else{document.getElementById('add_reply-<%= comment.id%>').style.display='none';}"></i></p>

<section id="add_reply-<%= comment.id%>" class="replyform"> 
<%= form_tag({:action=>"add_reply",:remote=>true,:comment_id=>comment.id,:post_id=>@post.id,:controller=>"comments",:namenil=>e_mail }) do %>
  <%= text_area_tag :reply,nil,:class=>"tag_field",:placeholder=>"Reply Content" %>
  <%= submit_tag 'Reply',:class=>'btn btn-info',:disable_with=>"Adding" %>
<% end %>
</section>

<div class="clear"></div>
</div>
<% end %>
</section>
<br />

<%= form_for([@post,@post.comments.build])  do |f| %>
<div class="field">
  <%= f.text_field :commenter ,:class=>"span12",:placeholder=>"Nicky Name"%>
</div>
<div class="field">
  <%= f.text_area :body, :class=>"span12 commentbody", :placeholder=>"New Comment here"%>
</div>
<div class="actions">
  <%= f.submit :class=>"btn btn-info"%>
</div>
<% end %>
